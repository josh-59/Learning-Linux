---
layout: default
title: The Linux Filesystem
---
<div id="nav_bar_2" class="nav">
    <ul>
        <li><a href="#introduction"> Introduction </a></li>
        <li><a href="#filesystems"> Filesystems </a></li>
        <li><a href="#directory-tree"> Directory Tree </a></li>
        <li><a href="#regular-files"> Regular Files </a></li>
        <li><a href="#directories"> Directories </a></li>
		<li><a href="#engineer-man"> Engineer Man </a></li>
        <li><a href="#references"> References </a></li>
        <li><a href="#credits">Credits and Licenses</a></li>
    </ul>
</div>

<div id="introduction" class="content">
    <h1>The Linux Filesystem</h1>
    <!-- <h4>In the beginning, there was a filesystem.</h4> -->
    <h4>Under Construction!</h4>

    <p>
        Unix began life as a filesystem (Kernighan 33-34).  Shortly thereafter, a means
        of interacting with it was created&mdash; initially,
		this consisted of an <code>exec</code>
        function, a shell, text editor and assembler.
        Written entirely by Ken Thompson, these key components formed the nexus of
        the time-sharing operating system that would eventually be called
        <em>Unix</em>.
    </p>

    <p>
        This file-first approach to operating system design is found in
        the implementation as well as the history of Unix and its derivatives:
		Unix and its derivatives use files for many things.
		As such, there is a lot to be said about files.
        This paper introduces the notion of a filesystem, and
        discusses the directory structure implemented with it.
    </p>
</div>

<div id="filesystems" class="content">
    <h2> Filesystems </h2>
    <p>
        A filesystem is a systematic method of organizing data on disk.<sup><a href="https://wiki.osdev.org/Filesystem">[1]</a><a href="https://wiki.archlinux.org/index.php/File_systems">[2]</a></sup>
        Conceptually, it is similar to a data structure, in that it defines a convention
        to be followed to store and retrieve data.
        Preparing a drive for use by a particular filesystem is known as formatting.
    </p>

    <ul>
        <h3>Some Common Filesystems:</h3>
        <li>
            <p>
                EXT4:
                Introduced in 2008,<sup><a href="https://en.wikipedia.org/wiki/Ext4">[1]</a></sup> EXT4 is the most common filesystem used on Linux
                today.  It is an evolutionary enhancement on EXT3,
                supporting larger filesizes, deeper subdirectory support,
                faster handling of large files, along with many other improvements.<sup><a href="https://ext4.wiki.kernel.org/index.php/Ext4_Disk_Layout">[3]</a></sup>
                It is mature, fast, and stable.
            </p>
        </li>

        <li>
            <p>
                ZFS:
					"Don't use ZFS.  It's that simple." &mdash;<a href="https://www.realworldtech.com/forum/?threadid=189711&curpostid=189841">Linus Torvalds</a>.
			</p>

			<p>
				Introduced in 2005,<sup><a href="https://en.wikipedia.org/wiki/ZFS">[2]</a></sup> ZFS incorporates fancier features that are generally
                out of place on an ordinary Linux desktop.
                It was developed by Sun Microsystems, and became closed-source with Sun's acquisition by
                Oracle.<sup><a href="https://en.wikipedia.org/wiki/ZFS">[2]</a></sup>
                It was intended for enterprise use, and is
                <a href="https://en.wikipedia.org/wiki/ZFS#Inappropriately_specified_systems">relatively easy to configure improperly.</a>
                Also, it is <a href="https://wiki.archlinux.org/index.php/ZFS">not free.</a>
            </p>
        </li>

        <li>
            <p>
                FAT32: The "File Allcoation Table 32-bit" is a DOS-era filesystem,<sup><a href="https://en.wikipedia.org/wiki/File_Allocation_Table#FAT32">[3]</a></sup>
                and is widely supported, though antiquated.
                In particular, it is not a <a href="https://en.wikipedia.org/wiki/Journaling_file_system">journaling filesystem</a>,
                so that changes to data are not recorded before being carried out (increasing the likelihood of
                corruption in the event of, say, power outage).
                This format is often used to hold the bootloader, since it is virtually guaranteed to be supported by firmware.
            </p>
        </li>
    </ul>

	<p>
		By and large, users of Linux don't often interact with the filesystem
		of their operating systems.
		The term was developed here to make a precise distinction between
		<em>filesystem</em> and <em>directory tree</em>.
	</p>

	<h3> See Also: </h3>
	<ul>
		<li> <a href="https://docs.fedoraproject.org/en-US/fedora/f28/install-guide/appendixes/Disk_Partitions/">An Introduction to Disk Partitions </a> </li>
	</ul>
</div>

<div id="directory-tree" class="content">
    <h2> Directory Tree</h2>

	<p>
		On top of a given filesystem, a directory structure is imposed by the operating system.
        On Linux and other Unix-like systems, that structure is a
		tree of files, also known as a hierarchy, which begins at "root,"
		denoted with a forward-slash:
	</p>

	<div class="code">
		/
	</div>

	<p>
        For Linux operating systems, this directory tree is defined
		by the <a href="https://www.pathname.com/fhs/pub/fhs-2.3.pdf">Linux Filesystem Heirarchy Standard</a>.
		As such, within any GNU/Linux distribution, some common themes will be found.
        For instance, <code>bin</code> directories are found in several places, such as
        <code>/bin</code> and <code>/sbin</code>, along with <code>/usr/bin</code> and often
        <code>/home/user/bin</code>.
		These contain binary executable files (programs), which
        can be ran as commands from the shell.
    </p>

    <p>
        As per the standard, <code>/etc</code> (usually read "<em>et</em>-c") contains host-specific
        system configuration files; as a consequence, you can expect to fiddle
		with the contents of this directory when configuring the system for the first time
        (or otherwise).
        It contains, for instance, files describing the configuration of the system's package
        manager, printers, and, well, etcetera.
    </p>

    <p>
        Unlike Windows systems, which mount a new, distinct directory tree
        for each storage device on the system (<code>C:\, D:\</code>, etc.),
        Linux systems place new filesystems within the existing
        directory structure, in an operation called
		<a href="https://www.man7.org/linux/man-pages/man8/mount.8.html"><em>mounting</em></a>.
		Because the directory structure is not rooted
		on a drive, it is more abstract than those of
		Windows lineage; in addition, the standard Linux directory structure
		is more stable over the duration of the machine's uptime.
	</p>

	<p>
		Suppose you have a usb stick with some music on it, and you'd
		like to access its contents.
		After it's plugged into your computer, the hardware, then the kernel,
		recognize it, but it is unaccessible:
	</p>

	<img style="width:80%" src="assets/img/mounting.png">

	<p>
		In practice, most distributions automatically mount
		usb sticks when they are plugged in.
		Moreover, no usb stick will be named <code>/dev/usb</code>; that was
		only a conceptual item.
		It's more likely to be named <code>/dev/sdb1</code>
	</p>

	<p>
		In Linux, the directory tree is used as a general-purpose meeting place:
		It holds references to hardware drivers, information about running
		processes, your terminal screen is represented by a file within the hierarchy;
		all of this in addition to regular files.
		This mechanism is general, extensible and allows both users and programmers
		access to the running machine.
		The only trick is keeping it organized.
	</p>

	<p>
		The entities in <code>/dev</code>,
		for instance, are called <em>special device files</em>
		(<a href="https://www.pathname.com/fhs/pub/fhs-2.3.pdf">Linux Filesystem Heirarchy Standard</a>, page 7);
		each file in <code>/dev</code> represents a device connected to the system (or an aspect of one).
		<code>/dev/sdb</code>, as used above, refers to a hard-disk (driver).
		<code>/dev/sdb1</code> refers to the first partition on that hard drive;
		<code>/dev/sdb2</code> refers to the second partition on that hard drive;
		etc..
	</p>

	<p>
		Among device special files, there are two distinct kinds:
		<em>block</em> special files and <em>character</em> special files.
		This distinction refers to the way that the kernel reads and writes to these files.
		Character special files are operated on a single character at a time
		(e.g., terminal); block special files are operated on a block of
		bytes (usually, 4096 or 8192) at a time, as in a hard drive.
	</p>

	<p>
		While there is too much going on in the <code>/dev</code> directory
		to exhaust the subject here,
		it's worth noting that utilities for displaying the current
		system's hardware often begin with <code>ls</code>:
	</p>

	<ul>
		<li><code><a href="http://man7.org/linux/man-pages/man8/lsblk.8.html">lsblk</a></code> - List block devices (hardrives, CD-drives, etc).  Useful to determine what drive to mount.</li>
		<li><code><a href="http://man7.org/linux/man-pages/man1/lscpu.1.html">lscpu</a></code> - Display information about the CPU architecture </li>
		<li><code><a href="http://man7.org/linux/man-pages/man8/lsusb.8.html">lsusb</a></code> - List usb devices </li>
		<li><code><a href="http://man7.org/linux/man-pages/man8/lspci.8.html">lspci</a></code> - List all PCI devices </li>
		<li><code><a href="http://man7.org/linux/man-pages/man8/lsmod.8.html">lsmod</a></code> - Show the status of modules in the Linux Kernel </li>
	</ul>

	<h3>See Also:</h3>
		<ul>
			<li><a href="https://www.man7.org/linux/man-pages/man7/file-hierarchy.7.html"><code>file-hierarchy(7)</code></a></li>
			<li><a href="https://www.man7.org/linux/man-pages/man8/mount.8.html"><code>mount(8)</code></a></li>
			<li><a href="https://www.man7.org/linux/man-pages/man8/umount.8.html"><code>umount(8)</code></a></li>
		</ul>

</div>
    <div id="regular-files" class="content">
        <h2>Regular Files</h2>

        <p>
            Regular files contain data.
            The contents of a regular file are not, in the general case, the business of the operating system.
            The operating system is tasked only with preserving data in a bit-perfect
            manner.
			That means that the Linux kernel treats text files, programs, movies,
            source code, pdf's, etc., identically,
            and that any "special treatment," is implemented by user-space processes.
		</p>

		<p>
            Approximately 80% of files are regular files (Stevens, p 98).
			We can verify this ourselves, by dividing the number of regular files,
		</p>

			<div class="code">
				$ sudo find / -type f | wc -l
			</div>
			<p>
				by the number of total files,
			</p>
			<div class="code">
				$ sudo find / | wc -l
			</div>
			<p>
				I arrive at 76%.
			</p>

		<p>
			Each file on the system has nine mode bits:
			<code>read</code>, <code>write</code> and <code>execute</code> for each,
			<em>owner</em>, <em>group</em>, <em>everyone else</em>
			(<a href="https://www.gnu.org/software/coreutils/manual/html_node/File-permissions.html#File-permissions">GNU Coreutils, section 27</a>).
			These are maintained by the filesystem along with other metadata about the file, such as size and location on-disk.
			For instance, the operating system will not even consider trying to execute a file if its
			appropriate executable bit is not set (but will allow you to pass the file as an argument to an executable&mdash;
			an interpreter, say).
		</p>

		<p>
			Mode bits are viewable with <code>ls -l</code>
		</p>

		<a href="assets/img/ls-long.pdf" target="_blank"><img src="assets/img/ls-long.png" style="width: 100%" title="Click for printable" ></a>

		<p>
			(The mode bits in question are leftmost in the entry.)
			Here we can see that <code>bash</code> is an executable file, and may be executed by
			everyone, but is only writable by <em>root</em>.
			File mode bits can be changed with the
			<a href="https://www.man7.org/linux/man-pages/man1/chmod.1.html"><code>chmod(1)</code></a> utility:
		</p>

		<h3>A Short Example</h3>

		<div class="code">
			$ echo "hello world" > newfile <br>
			$ cat newfile <br>
			hello world <br>
			$ chmod -r newfile &emsp;&emsp;&emsp;&emsp; #Remove read permissions on newfile<br>
			$ cat newfile <br>
			cat: newfile: Permission denied <br>
		</div>

		<p>
			If you use Linux a lot, there's a shortcut as old as Unix itself:
			Since the access permission bits
			are a sequence of bits, we can specify them in octal form.
			We begin our specification with <code>0</code> (zero),
			which denotes an octal constant.
			The next digit denotes permissions for the owner of the file,
			and is the sum of,
		</p>

		<div class="code">
				+4, for read  <br>
				+2, for write  <br>
				+1, for execute
		</div>

		<p>
			We use this pattern to determine the value for each <em>owner</em>, <em>group</em>
			and <em>everyone else</em>, and end up with the following equivalencies:
		</p>

		<div class="code">
			0664 &emsp;= &emsp;rw-rw-r-- <br>
			0421 &emsp;= &emsp;r---w---x
		</div>

		<h3>See Also:</h3>
		<ul>
			<li> <a href="https://www.man7.org/linux/man-pages/man1/chmod.1.html"<code>chmod(1)</code></a></li>
			<li> <a href="https://www.man7.org/linux/man-pages/man1/chown.1.html"<code>chown(1)</code></a></li>
		</ul>

        </div>

		<div id="directories" class="content">
			<h2>Directories</h2>

		</div>

		<div id="engineer-man" class="content">
			<h2>Engineer Man</h2>
			<iframe class="video" src="https://www.youtube.com/embed/UFIoRLqhFpo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
		</div>

        <div id="references" class="content">
            <h2> References </h2>
            <ol>
				<li> Filesystem Hierarchy Standard Group. <a href="https://www.pathname.com/fhs/pub/fhs-2.3.pdf">The Linux Filesystem Heirarchy Standard</a>.  Retrieved May 29, 2020.</li>
				<li> Stevens, W. Richard. <i><a href="http://www.apuebook.com/apue3e.html"> Advanced Programming in the Unix Environment.</a></i> Pearson Eduction, 2013.</li>
            </ol>

        </div>
